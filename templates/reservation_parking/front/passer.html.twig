{% extends 'base_front.html.twig' %}

{% block title %}Nouvelle Réservation{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="card border-0 shadow rounded-4">
                <div class="card-header text-white text-center py-3"
                     style="background: linear-gradient(135deg, #b30000, #cc0000); border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
                    <h4 class="mb-0">Réserver un Parking</h4>
                </div>

                <div class="card-body">
                    <form method="POST">

                        <!-- Étape 1 : Choix localisation -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Localisation</label>
                            <select class="form-select" onchange="location = this.value;">
                                <option value="">-- Choisissez une localisation --</option>
                                {% for loc in localisations %}
                                    <option value="{{ path('app_reservation_parking_book', {'localisationParking': loc}) }}"
                                        {% if loc == selected_localisation %}selected{% endif %}>
                                        {{ loc }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        {% if selected_localisation %}
                            <!-- Étape 2 : Choix du parking -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Parking</label>
                                <select name="parking" class="form-select" required>
                                    {% for parking in parkings %}
                                        <option value="{{ parking.idParking }}">
                                            {{ parking.nomParking }} ({{ parking.place }} places)
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Étape 3 : Date -->
                            <!-- Étape 3 : Date et heure -->
<div class="mb-3">
    <label class="form-label fw-bold">Date et heure de réservation</label>
    <input type="datetime-local" name="date_reservation" class="form-control" required>
</div>


                            <!-- Bouton -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-danger rounded-pill">Réserver</button>
                            </div>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% if reservationsUser is not empty %}
    <div class="mb-4">
        <h5 class="text-danger">Mes réservations</h5>
        <ul class="list-group mb-3">
            {% for res in reservationsUser %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ res.parking.nomParking }}</strong> –
                        {{ res.parking.localisationParking }} |
                        {{ res.dateReservation|date('d/m/Y H:i') }}
                    </div>
                    <form method="post" action="{{ path('app_reservation_parking_delete_front', {'idReservation': res.idReservation}) }}" onsubmit="return confirm('Supprimer cette réservation ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ res.idReservation) }}">
                        <button class="btn btn-sm btn-outline-danger">Supprimer</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

</div>
{% endblock %}
